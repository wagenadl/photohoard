{ "typ": "page",
  "cre": "2024-07-05T22:09:49.973",
  "mod": "2024-07-06T09:39:38.939",
  "cui": "2edabb2b1502c998",
  "stampTime": 0,
  "startPage": 75,
  "unlocked": false,
  "uuid": "4e685171",
  "cc": [
    { "typ": "resources",
      "cre": "2024-07-05T22:09:49.973",
      "mod": "2024-07-05T22:09:54.256",
      "uuid": "67c036c2",
      "cc": [
        { "typ": "res",
          "cre": "2024-07-05T22:09:53.965",
          "mod": "2024-07-05T22:09:54.256",
          "archive": "_1_-c55fa776.png",
          "desc": "",
          "preview": "",
          "source": "",
          "tag": "*1",
          "title": "",
          "uuid": "c55fa776"
        }
      ]
    },
    { "typ": "title",
      "cre": "2024-07-05T22:09:50.837",
      "mod": "2024-07-05T22:09:52.785",
      "uuid": "41cc12b8",
      "cc": [
        { "typ": "text",
          "cre": "2024-07-05T22:09:50.837",
          "mod": "2024-07-05T22:09:52.785",
          "lines": [
            0
          ],
          "text": "Crash",
          "uuid": "706cf571"
        }
      ]
    },
    { "typ": "gfxblock",
      "cre": "2024-07-05T22:09:53.964",
      "mod": "2024-07-06T09:06:22.229",
      "h": 591.043,
      "sheet": 0,
      "split": [ ],
      "uuid": "7bbfe3ee",
      "xref": 0.0,
      "y0": 72.0,
      "yref": -9.0,
      "cc": [
        { "typ": "gfximage",
          "cre": "2024-07-05T22:09:54.256",
          "mod": "2024-07-06T09:06:07.051",
          "cropBottom": 0.0,
          "cropLeft": 0.0,
          "cropRight": 0.0,
          "cropTop": 0.0,
          "height": 2118.0,
          "res": [
            "*1"
          ],
          "resName": "*1",
          "scale": 0.270559,
          "uuid": "db01ced0",
          "width": 1457.0,
          "x": 33.1965,
          "y": 0.0,
          "cc": [
            { "typ": "gfxsketch",
              "cre": "2024-07-06T08:12:51.453",
              "mod": "2024-07-06T08:12:52.065",
              "color": "#ee2200",
              "lineWidth": 1.5,
              "uuid": "7ac0617a",
              "x": 48.7796,
              "xx": [
                0.0,
                3.60831,
                7.93829,
                13.7116,
                16.5982,
                19.4849,
                24.5365,
                31.0315,
                36.8048,
                41.8564,
                44.7431,
                49.073,
                54.8463,
                62.7846,
                67.8363,
                72.1662,
                77.2179,
                85.1562,
                97.4244,
                103.919,
                108.971,
                115.466,
                127.013,
                132.786,
                137.116,
                142.168,
                145.776,
                149.384,
                153.714,
                157.322,
                159.487,
                161.652,
                165.982,
                168.869,
                171.756,
                173.921,
                176.807,
                181.137,
                184.746,
                189.076,
                191.962,
                194.849,
                197.014,
                199.901,
                204.23,
                207.117,
                210.725,
                213.612,
                216.499,
                218.664,
                222.272,
                225.88,
                228.045,
                232.375,
                235.262,
                238.87,
                241.035,
                243.922,
                246.087
              ],
              "y": 986.26,
              "yy": [
                0.0,
                -1.44332,
                -2.88665,
                -5.05164,
                -6.49496,
                -7.93829,
                -11.5466,
                -15.1549,
                -18.7632,
                -21.6499,
                -23.8149,
                -26.7015,
                -30.3098,
                -36.0831,
                -40.4131,
                -43.2997,
                -47.6297,
                -52.6814,
                -59.898,
                -64.9496,
                -70.0013,
                -75.7746,
                -84.4345,
                -88.7645,
                -91.6511,
                -96.7028,
                -101.033,
                -104.641,
                -108.249,
                -110.414,
                -112.579,
                -114.744,
                -119.074,
                -121.961,
                -124.848,
                -127.734,
                -131.343,
                -134.951,
                -139.281,
                -143.611,
                -147.219,
                -150.827,
                -153.714,
                -156.601,
                -160.931,
                -162.374,
                -165.261,
                -168.147,
                -171.034,
                -173.921,
                -178.251,
                -181.859,
                -184.024,
                -187.632,
                -189.797,
                -192.684,
                -194.849,
                -198.457,
                -201.344
              ]
            },
            { "typ": "gfxsketch",
              "cre": "2024-07-06T08:12:56.096",
              "mod": "2024-07-06T08:12:57.141",
              "color": "#ee2200",
              "lineWidth": 1.5,
              "uuid": "480d3418",
              "x": 11.4373,
              "xx": [
                0.0,
                3.60831,
                7.93829,
                12.2683,
                16.5982,
                20.2065,
                23.8149,
                27.4232,
                31.0315,
                34.6398,
                38.2481,
                41.8564,
                45.4647,
                49.073,
                52.6814,
                56.2897,
                59.1763
              ],
              "y": 980.926,
              "yy": [
                0.0,
                0.0,
                0.0,
                0.0,
                0.0,
                0.0,
                0.0,
                0.0,
                0.0,
                0.0,
                0.0,
                0.0,
                0.0,
                0.0,
                0.0,
                0.0,
                0.0
              ]
            }
          ]
        },
        { "typ": "gfxsketch",
          "cre": "2024-07-06T09:06:08.850",
          "mod": "2024-07-06T09:06:11.096",
          "color": "#ee2200",
          "lineWidth": 1.5,
          "uuid": "0eac02ff",
          "x": 8.86776,
          "xx": [
            0.0,
            3.60831,
            7.21662,
            10.8249,
            14.4332,
            18.0416,
            21.6499,
            21.6499,
            18.0416,
            20.2065,
            22.3715,
            20.9282,
            18.7632,
            15.1549
          ],
          "y": 310.141,
          "yy": [
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            -3.60831,
            -4.32997,
            -2.16499,
            0.0,
            2.88665,
            5.05164,
            7.21662
          ]
        },
        { "typ": "gfxsketch",
          "cre": "2024-07-06T09:06:20.026",
          "mod": "2024-07-06T09:06:22.229",
          "color": "#ee2200",
          "lineWidth": 1.5,
          "uuid": "7df094bb",
          "x": 3.09446,
          "xx": [
            0.0,
            3.60831,
            7.21662,
            10.8249,
            14.4332,
            18.0416,
            21.6499,
            20.2065,
            17.3199,
            20.2065,
            23.8149,
            22.3715,
            19.4849,
            18.7632
          ],
          "y": 446.535,
          "yy": [
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            0.0,
            -2.88665,
            -5.05164,
            -3.60831,
            -3.60831,
            -0.721662,
            0.721662,
            0.721662
          ]
        }
      ]
    },
    { "typ": "textblock",
      "cre": "2024-07-06T08:13:01.174",
      "mod": "2024-07-06T09:06:33.504",
      "h": 27.166,
      "ind": 0,
      "sheet": 0,
      "split": [ ],
      "uuid": "98ec967d",
      "y0": 663.043,
      "cc": [
        { "typ": "text",
          "cre": "2024-07-06T08:13:01.174",
          "mod": "2024-07-06T09:06:33.504",
          "lines": [
            0
          ],
          "text": "Red marks where 80380 starts. Arrows mark updateImage.",
          "uuid": "06536a83",
          "cc": [
            { "typ": "markup",
              "cre": "2024-07-06T09:06:34.760",
              "mod": "2024-07-06T09:06:34.760",
              "end": 53,
              "start": 42,
              "style": 1,
              "uuid": "42967262"
            }
          ]
        }
      ]
    },
    { "typ": "textblock",
      "cre": "2024-07-06T08:13:41.698",
      "mod": "2024-07-06T08:13:45.276",
      "h": 27.166,
      "ind": 0,
      "sheet": 1,
      "split": [ ],
      "uuid": "98ec967d",
      "y0": 72.0,
      "cc": [
        { "typ": "text",
          "cre": "2024-07-06T08:13:41.698",
          "mod": "2024-07-06T08:13:45.276",
          "lines": [
            0
          ],
          "text": "The order if events is:",
          "uuid": "06536a83"
        }
      ]
    },
    { "typ": "textblock",
      "cre": "2024-07-06T08:13:48.377",
      "mod": "2024-07-06T09:22:33.999",
      "h": 874.507,
      "ind": 6,
      "sheet": 1,
      "split": [
        605.88
      ],
      "uuid": "42792f2f",
      "y0": 99.166,
      "cc": [
        { "typ": "text",
          "cre": "2024-07-06T08:13:48.377",
          "mod": "2024-07-06T09:22:33.999",
          "lines": [
            0,
            71,
            98,
            164,
            218,
            229,
            295,
            355,
            425,
            489,
            551,
            615,
            673,
            736,
            785,
            849,
            917,
            979,
            1041,
            1099,
            1164,
            1223,
            1284,
            1345,
            1408,
            1460,
            1527,
            1535,
            1608,
            1658,
            1729,
            1792,
            1850,
            1915,
            1974,
            2031,
            2091,
            2146,
            2215,
            2277,
            2333,
            2398,
            2462,
            2480,
            2541,
            2596,
            2661,
            2726,
            2790
          ],
          "text": "1. SlideView (SV) gets asked to show a new photo (“version”). It calls its own update() function.\n2. SV gets a paint event and realizes it doesn’t have an image to display. Through its needLargerImage method, it emits needImage.\n3. This gets forwarded as LightTable’s (TT)  wantImage signal and also delivered to LiveAdjuster’s (LA) requestAdjusted slot.\n4. If the image exists at sufficient size in LA, it asks its internal InterruptableAdjuster (IA) to provide it through requestReduced → requestReducedROI. That cancels any outstanding requests to the underlying AllAdjuster, and marks a new request. Its thread picks up the request, retrieves the needed image from the AllAdjuster (which may need to do some work to provide it, but there is no further threading), and emits ready.\n5. However, this is not what happens in our bug case. The image does not yet exist in LA, so instead it calls requestScaledOriginal on its OriginalFinder (OF). That passes its request on to the underlying InterruptableFileReader or InterruptableRawReader, which eventually signals ready, at which point OF resumes through its provide slot. That emits either originalAvailable or scaledOriginalAvailable. In our case (version 80380, photo 80313), we have a jpeg, and the previous request (v 79757, p 79695) was also a jpeg, so Int’bleRawReader is not a factor.\n6. The (scaled)originalAvailable signal gets delivered to LA’s provide(Scaled)Original slot, which issues either a requestReduced or a requestFull call to the IA, and we are back to step 4.\n7. IA’s ready signal is delivered to LA’s provideAdjusted slot. Oddly, I don’t see this slot’s debug messages in the log. \n8. Instead, I see SV’s updateImage called, which only gets called from LightTable’s updateAdjusted and updateImage. LT’s updateImage, in turn, gets called from MainWindow’s updateImage, which updateAdjusted is a slot attached to LA’s imageAvailable signal. This can only come from LA’s provideAdjusted method. [This confuses me, because the pDebug statement has been there since dac9572a (220713), whereas my binary is dated 231015. strings confirms the message does exist in the binary.\n9. I think I slightly misunderstand. The call to LA::requestAdjusted causes two things to happen: (a) a small image gets generated quickly, (b) a large image more slowly. The small image (1024x768) gets delivered to SV::updateImage first, which causes a round trip through ThreadedTransform and eventually a call to SV’s setCMSImage.\n10. In the very same millisecond (in my crashing case), LA’s provideScaledOriginal is called. This would lead to an imageAvailable signal and hence a new call to SV’s updateImage. \n11. However, first SV’s paint event is called in reaction to the update() call from setCMSImage. This triggers a renewed request for a larger image.",
          "uuid": "55d557d8",
          "cc": [
            { "typ": "markup",
              "cre": "2024-07-06T08:15:34.715",
              "mod": "2024-07-06T08:15:38.334",
              "end": 200,
              "start": 185,
              "style": 1,
              "uuid": "a2335383"
            },
            { "typ": "markup",
              "cre": "2024-07-06T08:16:48.229",
              "mod": "2024-07-06T08:16:48.229",
              "end": 227,
              "start": 218,
              "style": 1,
              "uuid": "72f21aab"
            },
            { "typ": "markup",
              "cre": "2024-07-06T08:17:32.876",
              "mod": "2024-07-06T08:17:32.876",
              "end": 283,
              "start": 274,
              "style": 1,
              "uuid": "38661b67"
            },
            { "typ": "markup",
              "cre": "2024-07-06T08:18:49.545",
              "mod": "2024-07-06T08:18:49.545",
              "end": 348,
              "start": 333,
              "style": 1,
              "uuid": "01e52c86"
            },
            { "typ": "markup",
              "cre": "2024-07-06T08:21:16.956",
              "mod": "2024-07-06T08:21:16.956",
              "end": 488,
              "start": 474,
              "style": 1,
              "uuid": "7bdabe05"
            },
            { "typ": "markup",
              "cre": "2024-07-06T08:21:22.279",
              "mod": "2024-07-06T08:21:22.279",
              "end": 508,
              "start": 491,
              "style": 1,
              "uuid": "b1760f57"
            },
            { "typ": "markup",
              "cre": "2024-07-06T08:30:32.595",
              "mod": "2024-07-06T08:30:32.595",
              "end": 783,
              "start": 778,
              "style": 1,
              "uuid": "9a40ef47"
            },
            { "typ": "markup",
              "cre": "2024-07-06T08:31:30.724",
              "mod": "2024-07-06T08:31:30.724",
              "end": 916,
              "start": 895,
              "style": 1,
              "uuid": "6d9b91fe"
            },
            { "typ": "markup",
              "cre": "2024-07-06T08:34:07.841",
              "mod": "2024-07-06T08:34:07.841",
              "end": 1071,
              "start": 1066,
              "style": 1,
              "uuid": "23958210"
            },
            { "typ": "markup",
              "cre": "2024-07-06T08:34:27.482",
              "mod": "2024-07-06T08:34:27.482",
              "end": 1118,
              "start": 1111,
              "style": 1,
              "uuid": "d3414f51"
            },
            { "typ": "markup",
              "cre": "2024-07-06T08:35:08.305",
              "mod": "2024-07-06T08:35:08.305",
              "end": 1160,
              "start": 1143,
              "style": 1,
              "uuid": "34fcd757"
            },
            { "typ": "markup",
              "cre": "2024-07-06T08:35:12.593",
              "mod": "2024-07-06T08:35:12.593",
              "end": 1187,
              "start": 1164,
              "style": 1,
              "uuid": "af2b2a17"
            },
            { "typ": "markup",
              "cre": "2024-07-06T08:38:32.061",
              "mod": "2024-07-06T08:38:32.061",
              "end": 1377,
              "start": 1352,
              "style": 1,
              "uuid": "4b634a5a"
            },
            { "typ": "markup",
              "cre": "2024-07-06T08:38:53.796",
              "mod": "2024-07-06T08:38:53.796",
              "end": 1431,
              "start": 1408,
              "style": 1,
              "uuid": "11ebd01d"
            },
            { "typ": "markup",
              "cre": "2024-07-06T08:39:35.949",
              "mod": "2024-07-06T08:39:35.949",
              "end": 1474,
              "start": 1460,
              "style": 1,
              "uuid": "fb56ff90"
            },
            { "typ": "markup",
              "cre": "2024-07-06T08:39:39.090",
              "mod": "2024-07-06T08:39:39.090",
              "end": 1491,
              "start": 1480,
              "style": 1,
              "uuid": "b24b290f"
            },
            { "typ": "markup",
              "cre": "2024-07-06T08:40:49.534",
              "mod": "2024-07-06T08:40:49.535",
              "end": 1548,
              "start": 1543,
              "style": 1,
              "uuid": "5593205b"
            },
            { "typ": "markup",
              "cre": "2024-07-06T08:41:02.183",
              "mod": "2024-07-06T08:41:02.183",
              "end": 1592,
              "start": 1577,
              "style": 1,
              "uuid": "78c9c0c3"
            },
            { "typ": "markup",
              "cre": "2024-07-06T08:48:59.504",
              "mod": "2024-07-06T08:48:59.504",
              "end": 1692,
              "start": 1681,
              "style": 1,
              "uuid": "832c743e"
            },
            { "typ": "markup",
              "cre": "2024-07-06T08:49:11.791",
              "mod": "2024-07-06T08:49:11.791",
              "end": 1756,
              "start": 1742,
              "style": 1,
              "uuid": "ddf647d8"
            },
            { "typ": "markup",
              "cre": "2024-07-06T08:49:14.424",
              "mod": "2024-07-06T08:49:14.424",
              "end": 1772,
              "start": 1761,
              "style": 1,
              "uuid": "1c167904"
            },
            { "typ": "markup",
              "cre": "2024-07-06T08:49:50.614",
              "mod": "2024-07-06T08:49:50.614",
              "end": 1790,
              "start": 1779,
              "style": 1,
              "uuid": "e1bc81fc"
            },
            { "typ": "markup",
              "cre": "2024-07-06T08:50:01.309",
              "mod": "2024-07-06T08:50:01.309",
              "end": 1842,
              "start": 1831,
              "style": 1,
              "uuid": "5321904c"
            },
            { "typ": "markup",
              "cre": "2024-07-06T08:50:08.934",
              "mod": "2024-07-06T08:50:08.934",
              "end": 1864,
              "start": 1850,
              "style": 1,
              "uuid": "a60fde29"
            },
            { "typ": "markup",
              "cre": "2024-07-06T08:50:55.820",
              "mod": "2024-07-06T08:50:55.820",
              "end": 1906,
              "start": 1892,
              "style": 1,
              "uuid": "bf4bb3dc"
            },
            { "typ": "markup",
              "cre": "2024-07-06T08:52:22.955",
              "mod": "2024-07-06T08:52:22.955",
              "end": 1959,
              "start": 1944,
              "style": 1,
              "uuid": "130541de"
            },
            { "typ": "markup",
              "cre": "2024-07-06T08:53:53.620",
              "mod": "2024-07-06T08:53:53.620",
              "end": 2005,
              "start": 1999,
              "style": 1,
              "uuid": "e11d5686"
            },
            { "typ": "markup",
              "cre": "2024-07-06T08:56:24.588",
              "mod": "2024-07-06T08:56:24.588",
              "end": 2098,
              "start": 2091,
              "style": 1,
              "uuid": "d5bf5c86"
            },
            { "typ": "markup",
              "cre": "2024-07-06T08:59:41.327",
              "mod": "2024-07-06T08:59:41.327",
              "end": 2214,
              "start": 2199,
              "style": 1,
              "uuid": "cac338fd"
            },
            { "typ": "markup",
              "cre": "2024-07-06T09:01:18.552",
              "mod": "2024-07-06T09:01:18.552",
              "end": 2478,
              "start": 2467,
              "style": 1,
              "uuid": "c3e149b0"
            },
            { "typ": "markup",
              "cre": "2024-07-06T09:02:21.778",
              "mod": "2024-07-06T09:02:21.778",
              "end": 2562,
              "start": 2541,
              "style": 1,
              "uuid": "c2eb6cbb"
            },
            { "typ": "markup",
              "cre": "2024-07-06T09:03:04.470",
              "mod": "2024-07-06T09:03:04.470",
              "end": 2610,
              "start": 2596,
              "style": 1,
              "uuid": "0b8f27fd"
            },
            { "typ": "markup",
              "cre": "2024-07-06T09:03:46.204",
              "mod": "2024-07-06T09:03:46.205",
              "end": 2658,
              "start": 2647,
              "style": 1,
              "uuid": "8bbd5e37"
            },
            { "typ": "markup",
              "cre": "2024-07-06T09:04:39.358",
              "mod": "2024-07-06T09:04:39.358",
              "end": 2732,
              "start": 2726,
              "style": 1,
              "uuid": "f42f0e77"
            },
            { "typ": "markup",
              "cre": "2024-07-06T09:04:44.186",
              "mod": "2024-07-06T09:04:44.186",
              "end": 2756,
              "start": 2745,
              "style": 1,
              "uuid": "c57a2579"
            }
          ]
        }
      ]
    },
    { "typ": "textblock",
      "cre": "2024-07-06T09:22:36.082",
      "mod": "2024-07-06T09:24:15.206",
      "h": 96.664,
      "ind": 0,
      "sheet": 2,
      "split": [ ],
      "uuid": "b7f35b30",
      "y0": 340.627,
      "cc": [
        { "typ": "text",
          "cre": "2024-07-06T09:22:36.082",
          "mod": "2024-07-06T09:24:15.206",
          "lines": [
            0,
            64,
            126,
            183
          ],
          "text": "I changed the logic for needLargerImage to only issue a request when no outstanding request for the same image size exists. I cannot immediately tell if that resolves the rare crash. Certainly, the",
          "uuid": "a7b7b135",
          "cc": [
            { "typ": "markup",
              "cre": "2024-07-06T09:22:46.911",
              "mod": "2024-07-06T09:22:46.911",
              "end": 39,
              "start": 24,
              "style": 1,
              "uuid": "5b628752"
            }
          ]
        }
      ]
    },
    { "typ": "textblock",
      "cre": "2024-07-06T09:24:16.631",
      "mod": "2024-07-06T09:24:22.808",
      "h": 19.147,
      "ind": 3,
      "sheet": 2,
      "split": [ ],
      "uuid": "a9ac2422",
      "y0": 437.291,
      "cc": [
        { "typ": "text",
          "cre": "2024-07-06T09:24:16.631",
          "mod": "2024-07-06T09:24:22.807",
          "lines": [
            0
          ],
          "text": "Paint devicereturned engine ≡ 0, type: 3",
          "uuid": "5b82df97"
        }
      ]
    },
    { "typ": "textblock",
      "cre": "2024-07-06T09:24:26.246",
      "mod": "2024-07-06T09:24:49.500",
      "h": 50.332,
      "ind": 0,
      "sheet": 2,
      "split": [ ],
      "uuid": "1604a314",
      "y0": 456.438,
      "cc": [
        { "typ": "text",
          "cre": "2024-07-06T09:24:26.246",
          "mod": "2024-07-06T09:24:49.500",
          "lines": [
            0,
            65
          ],
          "text": "and following errors are suspicious. And the crash in blur() may also be unrelated.",
          "uuid": "cb06ad6f"
        }
      ]
    },
    { "typ": "textblock",
      "cre": "2024-07-06T09:36:18.203",
      "mod": "2024-07-06T09:36:41.174",
      "h": 50.332,
      "ind": 1,
      "sheet": 2,
      "split": [ ],
      "uuid": "79a6b375",
      "y0": 506.77,
      "cc": [
        { "typ": "text",
          "cre": "2024-07-06T09:36:18.203",
          "mod": "2024-07-06T09:36:41.173",
          "lines": [
            0,
            58
          ],
          "text": "I instrumented all (or at least most) calls to QPainter’s setBrush method to try to catch the inactive painter problem.",
          "uuid": "bd6e2717"
        }
      ]
    },
    { "typ": "textblock",
      "cre": "2024-07-06T09:36:47.458",
      "mod": "2024-07-06T09:39:38.939",
      "h": 96.664,
      "ind": 1,
      "sheet": 2,
      "split": [ ],
      "uuid": "512c3b85",
      "y0": 557.102,
      "cc": [
        { "typ": "text",
          "cre": "2024-07-06T09:36:47.458",
          "mod": "2024-07-06T09:39:38.939",
          "lines": [
            0,
            63,
            126,
            190
          ],
          "text": "But the real hint might be the crash in blur(). There are only two calls to blur() in the codebase, both in Layers::mask(). I have a suspicion there may be an empty request. In that case, I now return a null image.",
          "uuid": "f6965311",
          "cc": [
            { "typ": "markup",
              "cre": "2024-07-06T09:37:22.185",
              "mod": "2024-07-06T09:37:22.185",
              "end": 120,
              "start": 116,
              "style": 1,
              "uuid": "8a729208"
            }
          ]
        }
      ]
    }
  ]
}
